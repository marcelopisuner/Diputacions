<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Evolució de la despesa – Visualització interactiva</title>
  <style>
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 2rem;
      background:#fafafa;
      color:#222;
    }
    h1{
      text-align:center;
      margin-bottom:1.5rem;
    }
    select{
      padding:0.4rem 0.6rem;
      font-size:1rem;
    }
    #plotImage{
      display:none;
      margin:0 auto;
      max-width:90%;
      height:auto;
      border:1px solid #ccc;
      box-shadow:0 2px 4px rgba(0,0,0,.1);
      background:white;
    }
    footer{
      text-align:center;
      margin-top:2rem;
      font-size:0.85rem;
      color:#666;
    }

  /* Layout for controls */
  #controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }

  /* Styled dropdown */
  select#plotSelect {
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: #fff;
    transition: border-color 0.2s;
  }
  select#plotSelect:focus {
    outline: none;
    border-color: #007BFF;
  }

  /* Rounded main image */
  #plotImage {
    border-radius: 4px;
  }

  /* Gallery grid layout: 4 items per row */
  #gallery ul {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    list-style: none;
    padding: 0;
    margin-top: 1.5rem;
  }
  #gallery li {
    margin: 0;
  }
  #gallery li a {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 150px;
    text-decoration: none;
    font-size: 1.1rem;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 8px;
    transition: background-color 0.2s, transform 0.2s;
  }
  #gallery li a:hover {
    background-color: #0056b3;
    transform: translateY(-4px);
  }
  </style>
  <script src="data.js"></script>
</head>
<body>
  <h1>Evolució de la despesa</h1>
  <div id="controls">
    <label for="plotSelect">Tria gràfic:</label>
    <select id="plotSelect"></select>
  </div>

  <img id="plotImage" alt="Gràfic de despesa" src="" />
  <!-- Gallery of all available plots -->
  <div id="gallery"></div>
  
  <footer>
    Fes servir el desplegable per canviar de gràfic. Els fitxers <code>.png</code> han d'estar a la carpeta <code>Barcelona/Eco-func</code>.
  </footer>

  <script>
    /* ------------------------------------------------------------------
       CONFIGURACIÓ
       ------------------------------------------------------------------
       – La convenció de noms de fitxer és:
         plot_<SUFIX>_<PREFIX>.png   (p.ex. plot_130_1.png)
       – PREFIXOS obligatoris: 1‑4 i 6‑9
       – SUFIXOS: els mateixos que existeixen al vostre conjunt de dades.
       Afegiu tots els sufixos presents al vostre projecte a l'array `suffixes`
       ------------------------------------------------------------------ */
    const prefixes = ["1","2","3","4","6","7","8","9"];

    /*  TODO: afegiu aquí tots els sufixos detectats als vostres fitxers       *
     *  Exemple: ["130","210","310","490"]                                      */
    const suffixes = [
      "130" /* , "210", "310", ... */
    ];
    /* ------------------------------------------------------------------ */

    const select = document.getElementById("plotSelect");
    const img    = document.getElementById("plotImage");

    // Add placeholder option so no image shows until user selects
    const placeholder = document.createElement("option");
    placeholder.textContent = "Tria un gràfic...";
    placeholder.disabled = true;
    placeholder.selected = true;
    select.appendChild(placeholder);
    // Populate dropdown from data.js
    if (window.plotFiles && plotFiles.length) {
      plotFiles.forEach(file => {
        const labelBase = file.replace(/^bcn_ef_plot_/, '').replace(/\.png$/, '');
        const [suffix, prefix] = labelBase.split('_');
        const val = `${prefix}_${suffix}`;
        const opt = document.createElement('option');
        opt.value = file;
        opt.textContent = val;
        select.appendChild(opt);
      });
    }


    /* Funció per actualitzar la imatge mostrada */
    function updateImage(){
      const file = select.value;
      if (!file) return;
      img.src = `Barcelona/Eco-func/${file}`;
      const labelBase = file.replace(/^bcn_ef_plot_/, '').replace(/\.png$/, '');
      const [suffix, prefix] = labelBase.split('_');
      img.alt = `Gràfic ${prefix}_${suffix}`;
      img.style.display = 'block';
    }

    /* Actualitza la imatge quan canvia la selecció */
    select.addEventListener("change", updateImage);

    // Open dropdown when the label is clicked
    const label = document.querySelector('label[for="plotSelect"]');
    label.addEventListener("click", () => {
      select.focus();
      select.click();
    });

    /* Build gallery grid from data.js */
    const gallery = document.getElementById('gallery');
    const ul = document.createElement('ul');
    gallery.appendChild(ul);
    if (window.plotFiles && plotFiles.length) {
      plotFiles.forEach(file => {
        const labelBase = file.replace(/^bcn_ef_plot_/, '').replace(/\.png$/, '');
        const [suffix, prefix] = labelBase.split('_');
        const display = `${prefix}_${suffix}`;
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = '#';
        a.textContent = display;
        a.onclick = (e) => {
          e.preventDefault();
          img.src = `Barcelona/Eco-func/${file}`;
          img.alt = `Gràfic ${display}`;
          img.style.display = 'block';
          select.value = file;
        };
        li.appendChild(a);
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>